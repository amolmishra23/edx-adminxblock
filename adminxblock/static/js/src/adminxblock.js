// javascript file for the sake of studioview.html
function StudioView (runtime, element) {

    // the handlerUrl for the sake of calling 'perform' function from the python script
    var handlerUrl1 = runtime.handlerUrl(element, 'perform');
    // opt variable holds the detail of option selected by user
    var opt='';
    // detail variable contains the complete data to be sent. we send it in the form of option_selected+parameters_for_that_option.
    var detail = '';


    // function to be executed on successful execution of ajax request
    function finalCall(result){
        document.getElementById('b2').style.display = 'none';
        document.getElementById(opt).style.display = 'none';
        document.getElementById('d09').style.display = 'block';
        console.log(result.success);
        var str=result.success;
	    str = str.split('$#').join('<br>');
        $('.success', element).html(str);
    }


    // function to be called on the click of submit button, on the options page
    $('#b1', element ).click(function (eventObject) {
        opt = $('input[name=opt]:checked').val();
        // veryfying if no option is selected
        if (!opt){
            alert('Please select an option');
            $("#b3").click();
            return;
        }
        // hiding and displaying stuff accordingly
        var x0 = document.getElementById('d0');
        var x1 = document.getElementById(opt);
        x0.style.display = 'none';
        document.getElementById('b1').style.display = 'none';
        x1.style.display = 'block';
        document.getElementById('b2').style.display = 'block';
    });


    // function to be called on the click of submit button, on the sub-options page
    $('#b2', element ).click(function (eventObject) {
        // setting the detail variable accordingly as per event generated by user
        detail='';
        if (opt == 'd01') {
            if (/^course-v[0-9]:[A-z]+[+][A-z0-9]+[+][A-z0-9]+$/.test(document.getElementById("o1t1").value)){
                var c1=confirm("Are you sure to delete the course?");
                if (c1==true){
                    var c2=confirm("Are you very sure to delete the course?");
                    if (c2==true){                        
                            detail = detail+opt+' '+document.getElementById("o1t1").value;    
                    }
                    else{
                        $("#b3").click();
                        return;
                    }
                }
                else{
                    $("#b3").click();
                    return;
                }
            }
            else{
                alert("Please enter a valid Course ID to be deleted");    
            }
        }
        else if (opt == 'd02') {
            if (/(https?:\/\/(.+?\.)?github\.com(\/[A-Za-z0-9\-\._~:\/\?#\[\]@!$&'\(\)\*\+,;\=]*)?)/.test(document.getElementById("o2t1").value)){
                detail = detail+opt+' '+document.getElementById("o2t1").value;    
            }
            else{
                alert("Please enter a valid git URL to be imported");
            }
        }
        else if (opt == 'd03') {
            detail = detail+opt+' '+'garbage';    
        }
        else if (opt == 'd04') {
            if (/^course-v[0-9]:[A-z]+[+][A-z0-9]+[+][A-z0-9]+$/.test(document.getElementById("o4t1").value)){
                detail = detail+opt+' '+document.getElementById("o4t1").value;    
            }
            else{
                alert("Please enter a valid Course ID to be exported");
            }
        }
        else if (opt == 'd05') {
            if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(document.getElementById("o5t1").value)){
                detail = detail+opt+' '+document.getElementById("o5t1").value;    
            }
            else{
                alert("Please enter a valid Email ID to be activated");
            }
        }
        else if (opt == 'd06') {
            if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(document.getElementById("o6t1").value)){
                detail = detail+opt+' '+document.getElementById("o6t1").value;    
            }
            else{
                alert("Please enter a valid Email ID to be deactivated");
            }
        }
        else if (opt == 'd07') {
            if ((/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(document.getElementById("o7t1").value)) && (/^course-v[0-9]:[A-z]+[+][A-z0-9]+[+][A-z0-9]+$/.test(document.getElementById("o7t2").value))){
                detail = detail+opt+' '+document.getElementById("o7t1").value+' '+document.getElementById("o7t2").value;
            }
            else{
                alert("Please enter a valid Email ID and valid Course ID for certificate generation");
            }
        }
        else if (opt == 'd08') {
            if (/^course-v[0-9]:[A-z]+[+][A-z0-9]+[+][A-z0-9]+$/.test(document.getElementById("o8t1").value)){
                detail = detail+opt+' '+document.getElementById("o8t1").value;    
            }
            else{
                alert("Please enter a valid Course ID for certificate generation");
            }
        }
        // sending ajax request
        if (detail!=''){
            $.ajax({
                type: "POST",
                url: handlerUrl1,
                data: JSON.stringify({"detail": detail}),
                success: finalCall
            });
        }
    });


    // this is the functionality for rest button
    $('#b3', element ).click(function (eventObject) {
        document.getElementById('d0').style.display = 'block';
        document.getElementById('b1').style.display = 'block';
        document.getElementById('d01').style.display = 'none';
        document.getElementById('d02').style.display = 'none';
        document.getElementById('d03').style.display = 'none';
        document.getElementById('d04').style.display = 'none';
        document.getElementById('d05').style.display = 'none';
        document.getElementById('d06').style.display = 'none';
        document.getElementById('d07').style.display = 'none';
        document.getElementById('d08').style.display = 'none';
        document.getElementById('d09').style.display = 'none';
        document.getElementById('b2').style.display = 'none';
    });

    $(function ($) {

    });
}
